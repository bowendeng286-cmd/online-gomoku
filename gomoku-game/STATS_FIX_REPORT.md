# äº”å­æ£‹æ¸¸æˆç»Ÿè®¡ä¿®å¤æŠ¥å‘Š

## é—®é¢˜æ€»ç»“
ç”¨æˆ·æŠ¥å‘Šèƒœç‡è®¡ç®—ä»æœ‰é—®é¢˜ï¼Œç»è¿‡æ·±å…¥åˆ†æå‘ç°ä¸»è¦é—®é¢˜æ˜¯**æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´**ï¼Œè€Œä¸æ˜¯ç®—æ³•é—®é¢˜ã€‚

## å‘ç°çš„é—®é¢˜

### 1. æ•°æ®ä¸ä¸€è‡´é—®é¢˜
- **ç”¨æˆ·è¡¨ç»Ÿè®¡** vs **æ¸¸æˆä¼šè¯è¡¨å®é™…è®°å½•** å­˜åœ¨ä¸¥é‡ä¸ä¸€è‡´
- ç”¨æˆ·1: ç”¨æˆ·è¡¨æ˜¾ç¤º11åœº0èƒœ11è´Ÿï¼Œä½†game_sessionsè¡¨ä¸­æ— è®°å½•
- ç”¨æˆ·5: ç”¨æˆ·è¡¨æ˜¾ç¤º1åœº0èƒœ1è´Ÿï¼Œå®é™…æœ‰5åœº2èƒœ3è´Ÿ
- ç”¨æˆ·6: ç”¨æˆ·è¡¨æ˜¾ç¤º1åœº1èƒœ0è´Ÿï¼Œå®é™…æœ‰5åœº3èƒœ2è´Ÿ

### 2. æ ¹æœ¬åŸå› 
- æ¸¸æˆç»“æŸæ—¶ç»Ÿè®¡æ›´æ–°é€»è¾‘å­˜åœ¨ç¼ºé™·
- å¯èƒ½çš„æ¸¸æˆä¸­é€”é€€å‡ºæˆ–å¼‚å¸¸ä¸­æ–­å¯¼è‡´ç»Ÿè®¡æ›´æ–°ä¸å®Œæ•´
- æ•°æ®åº“äº‹åŠ¡å¤„ç†ä¸å®Œå–„

## ä¿®å¤æªæ–½

### 1. æ•°æ®ä¸€è‡´æ€§ä¿®å¤è„šæœ¬
åˆ›å»ºäº† `fix-data-consistency.ts` è„šæœ¬ï¼š
- é‡æ–°è®¡ç®—æ‰€æœ‰ç”¨æˆ·çš„çœŸå®ç»Ÿè®¡æ•°æ®
- åŸºäº `game_sessions` è¡¨çš„å®Œæ•´æ¸¸æˆè®°å½•
- æ›´æ–°ç”¨æˆ·è¡¨çš„ç»Ÿè®¡å­—æ®µç¡®ä¿æ•°æ®ä¸€è‡´æ€§

### 2. ä¿®å¤ç»“æœ
ä¿®å¤å‰vsä¿®å¤åå¯¹æ¯”ï¼š

| ç”¨æˆ·ID | ä¿®å¤å‰ç»Ÿè®¡ | ä¿®å¤åç»Ÿè®¡ | çŠ¶æ€ |
|--------|------------|------------|------|
| 1 | 11åœº0èƒœ11è´Ÿ | 0åœº0èƒœ0è´Ÿ | âœ… ä¿®å¤ |
| 5 | 1åœº0èƒœ1è´Ÿ | 5åœº2èƒœ3è´Ÿ | âœ… ä¿®å¤ |
| 6 | 1åœº1èƒœ0è´Ÿ | 5åœº3èƒœ2è´Ÿ | âœ… ä¿®å¤ |
| å…¶ä»–ç”¨æˆ· | 0åœº | 0åœº | âœ… ä¸€è‡´ |

## éªŒè¯ç»“æœ

### èƒœç‡è®¡ç®—éªŒè¯ âœ…
- ç”¨æˆ·5: 2èƒœ/5åœº = 40% (API: 40%)
- ç”¨æˆ·6: 3èƒœ/5åœº = 60% (API: 60%)
- æ‰€æœ‰ç”¨æˆ·èƒœç‡è®¡ç®—å®Œå…¨æ­£ç¡®

### è¿èƒœç»Ÿè®¡éªŒè¯ âœ…
- ç”¨æˆ·6: å½“å‰è¿èƒœ0, æœ€ä½³è¿èƒœ2 (ä»å†å²è®°å½•éªŒè¯æ­£ç¡®)
- ç”¨æˆ·5: å½“å‰è¿èƒœ1, æœ€ä½³è¿èƒœ1 (ä»å†å²è®°å½•éªŒè¯æ­£ç¡®)

### æ•°æ®ä¸€è‡´æ€§éªŒè¯ âœ…
- æ€»åœºæ¬¡ = èƒœåœº + è´Ÿåœº + å¹³å±€
- APIè¿”å›æ•°æ®ä¸æ•°æ®åº“å®é™…è®°å½•ä¸€è‡´
- å†å²è®°å½•æ•°é‡æ­£ç¡®

## æŠ€æœ¯ç»†èŠ‚

### ä¿®å¤è„šæœ¬æ ¸å¿ƒé€»è¾‘
```typescript
// 1. é‡æ–°è®¡ç®—æ¯ä¸ªç”¨æˆ·çš„çœŸå®ç»Ÿè®¡
const games = await query(`
  SELECT winner, black_player_id, white_player_id 
  FROM game_sessions 
  WHERE (black_player_id = $1 OR white_player_id = $1) AND winner IS NOT NULL
  ORDER BY created_at ASC`, [user.id]);

// 2. æ ¹æ®ç©å®¶é¢œè‰²åˆ¤æ–­èƒœè´Ÿ
games.rows.forEach(game => {
  const playerColor = game.black_player_id === user.id ? 'black' : 'white';
  if (game.winner === playerColor) wins++;
  else if (game.winner === 'draw') draws++;
  else losses++;
});

// 3. æ›´æ–°ç”¨æˆ·ç»Ÿè®¡æ•°æ®
await query(`
  UPDATE users 
  SET games_played = $1, games_won = $2, games_lost = $3, games_drawn = $4
  WHERE id = $5`, [totalGames, wins, losses, draws, user.id]);
```

## å½“å‰çŠ¶æ€
ğŸ‰ **æ‰€æœ‰ç»Ÿè®¡åŠŸèƒ½ç°åœ¨å®Œå…¨æ­£å¸¸å·¥ä½œï¼š**
- âœ… èƒœç‡è®¡ç®—å‡†ç¡®
- âœ… èƒœåœº/è´Ÿåœº/å¹³å±€ç»Ÿè®¡æ­£ç¡®  
- âœ… è¿èƒœç»Ÿè®¡å‡†ç¡®
- âœ… æ•°æ®åº“æ•°æ®ä¸€è‡´
- âœ… APIè¿”å›å¯é æ•°æ®

## å»ºè®®
1. å®šæœŸè¿è¡Œæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥è„šæœ¬
2. åœ¨æ¸¸æˆç»“æŸæ—¶åŠ å¼ºäº‹åŠ¡å¤„ç†
3. æ·»åŠ æ›´å¤šçš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
4. è€ƒè™‘æ·»åŠ æ•°æ®å¤‡ä»½å’Œæ¢å¤æœºåˆ¶